<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰§æœ¬è½¬é»‘ç™½åˆ†é•œç¨¿ç”Ÿæˆå™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Serif SC', serif;
            background-color: #0a0a0a;
            color: #e5e5e5;
        }
        .mono {
            font-family: 'JetBrains Mono', monospace;
        }
        .storyboard-grid {
            background-image: 
                linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .shot-card {
            transition: all 0.3s ease;
            border: 1px solid #333;
        }
        .shot-card:hover {
            border-color: #666;
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .comic-border {
            position: relative;
        }
        .comic-border::after {
            content: '';
            position: absolute;
            top: -2px; left: -2px; right: -2px; bottom: -2px;
            background: linear-gradient(45deg, #fff 0%, transparent 20%, transparent 80%, #fff 100%);
            z-index: -1;
            opacity: 0.1;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #fff;
        }
        .typewriter {
            overflow: hidden;
            border-right: 2px solid #fff;
            white-space: nowrap;
            animation: typing 3s steps(40, end), blink-caret 0.75s step-end infinite;
        }
        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }
        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: #fff; }
        }
        .grain {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 50;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }
        @media print {
            .no-print { display: none !important; }
            body { background: white; color: black; }
            .shot-card { border: 1px solid #000; break-inside: avoid; }
        }
    </style>
</head>
<body class="min-h-screen storyboard-grid">
    <div class="grain"></div>
    
    <!-- Header -->
    <header class="border-b border-neutral-800 bg-black/80 backdrop-blur-sm sticky top-0 z-40 no-print">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-white text-black flex items-center justify-center font-bold text-lg mono">S</div>
                <h1 class="text-xl font-bold tracking-wider">STORYBOARD<span class="text-neutral-500">_GEN</span></h1>
            </div>
            <div class="flex gap-3">
                <button onclick="loadExample()" class="px-4 py-2 text-sm border border-neutral-700 hover:border-white transition-colors">
                    åŠ è½½ç¤ºä¾‹
                </button>
                <button onclick="exportStoryboard()" class="px-4 py-2 text-sm bg-white text-black font-bold hover:bg-neutral-200 transition-colors">
                    å¯¼å‡ºåˆ†é•œç¨¿
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 py-8 flex flex-col lg:flex-row gap-8">
        <!-- Input Panel -->
        <div class="lg:w-1/3 space-y-6 no-print">
            <div class="border border-neutral-800 bg-neutral-900/50 p-6 space-y-4">
                <h2 class="text-sm font-bold text-neutral-400 uppercase tracking-widest mb-4">å‰§æœ¬è¾“å…¥</h2>
                
                <div>
                    <label class="block text-xs text-neutral-500 mb-2 uppercase tracking-wider">ç‰‡å</label>
                    <input type="text" id="projectTitle" placeholder="è¾“å…¥ç‰‡å..." 
                        class="w-full bg-black border border-neutral-700 p-3 text-white placeholder-neutral-600 focus:border-white transition-colors">
                </div>

                <div>
                    <label class="block text-xs text-neutral-500 mb-2 uppercase tracking-wider">åœºæ™¯æè¿°</label>
                    <input type="text" id="sceneDesc" placeholder="ä¾‹å¦‚ï¼šå†…æ™¯ å’–å•¡é¦† æ—¥" 
                        class="w-full bg-black border border-neutral-700 p-3 text-white placeholder-neutral-600 focus:border-white transition-colors">
                </div>

                <div>
                    <label class="block text-xs text-neutral-500 mb-2 uppercase tracking-wider">å‰§æœ¬å†…å®¹</label>
                    <textarea id="scriptInput" rows="12" placeholder="åœ¨æ­¤ç²˜è´´å‰§æœ¬å†…å®¹...
æ ¼å¼ç¤ºä¾‹ï¼š
é•œå¤´1 ç‰¹å†™ å’–å•¡æ¯ä¸­çš„æ¶Ÿæ¼ª
æœåŠ¡å‘˜ï¼šæ‚¨çš„å’–å•¡å¥½äº†ã€‚

é•œå¤´2 ä¸­æ™¯ é¡¾å®¢æŠ¬å¤´
é¡¾å®¢ï¼šè°¢è°¢ã€‚" 
                        class="w-full bg-black border border-neutral-700 p-3 text-white placeholder-neutral-600 focus:border-white transition-colors mono text-sm leading-relaxed resize-y"></textarea>
                </div>

                <button onclick="parseScript()" 
                    class="w-full py-3 bg-white text-black font-bold hover:bg-neutral-200 transition-all active:scale-95">
                    ç”Ÿæˆåˆ†é•œç¨¿
                </button>
            </div>

            <div class="border border-neutral-800 bg-neutral-900/30 p-4 text-xs text-neutral-500 space-y-2">
                <p class="font-bold text-neutral-400">ä½¿ç”¨è¯´æ˜ï¼š</p>
                <p>â€¢ ä½¿ç”¨"é•œå¤´X"æ ‡è®°æ–°é•œå¤´</p>
                <p>â€¢ è‡ªåŠ¨è¯†åˆ«æ™¯åˆ«ï¼šç‰¹å†™/è¿‘æ™¯/ä¸­æ™¯/å…¨æ™¯/è¿œæ™¯</p>
                <p>â€¢ å†’å·å‰ä¸ºè§’è‰²åï¼Œåä¸ºå°è¯</p>
            </div>
        </div>

        <!-- Preview Panel -->
        <div class="lg:w-2/3">
            <div id="storyboardContainer" class="space-y-6">
                <!-- Empty State -->
                <div class="border-2 border-dashed border-neutral-800 p-12 text-center text-neutral-600">
                    <div class="text-4xl mb-4">ğŸ¬</div>
                    <p class="text-lg mb-2">ç­‰å¾…å‰§æœ¬è¾“å…¥</p>
                    <p class="text-sm">åœ¨å·¦ä¾§è¾“å…¥å‰§æœ¬å†…å®¹å¹¶ç‚¹å‡»ç”Ÿæˆ</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        let currentShots = [];

        function loadExample() {
            document.getElementById('projectTitle').value = 'ã€Šåˆå¤œå’–å•¡é¦†ã€‹';
            document.getElementById('sceneDesc').value = 'å†…æ™¯ å¤å¤å’–å•¡é¦† å¤œ';
            document.getElementById('scriptInput').value = `é•œå¤´1 å…¨æ™¯ é›¨å¤œä¸­çš„å’–å•¡é¦†ï¼Œéœ“è™¹ç¯é—ªçƒ
é•œå¤´2 ç‰¹å†™ é—¨æŠŠæ‰‹è½¬åŠ¨ï¼Œæ°´æ»´æ»‘è½
é•œå¤´3 ä¸­æ™¯ ç”·äººæ¨é—¨è€Œå…¥ï¼Œé£è¡£æ¹¿é€
ç”·äººï¼šä¸€æ¯ç¾å¼ï¼Œè°¢è°¢ã€‚
é•œå¤´4 è¿‘æ™¯ æœåŠ¡å‘˜æ“¦æ‹­æ¯å­ï¼Œçœ¼ç¥è­¦æƒ•
æœåŠ¡å‘˜ï¼šè¿™ä¹ˆæ™šäº†ï¼Œå…ˆç”Ÿã€‚
é•œå¤´5 ç‰¹å†™ ç”·äººä»æ€€ä¸­æå‡ºä¿¡å°
ç”·äººï¼šæˆ‘åœ¨ç­‰äººã€‚
é•œå¤´6 è¿œæ™¯ è¡—è§’å¤„ï¼Œé»‘è‰²è½¿è½¦ç¼“ç¼“åœä¸‹`;
            parseScript();
        }

        function parseScript() {
            const title = document.getElementById('projectTitle').value || 'æœªå‘½åé¡¹ç›®';
            const scene = document.getElementById('sceneDesc').value || '';
            const input = document.getElementById('scriptInput').value;
            
            if (!input.trim()) {
                alert('è¯·è¾“å…¥å‰§æœ¬å†…å®¹');
                return;
            }

            const lines = input.split('\n').filter(line => line.trim());
            currentShots = [];
            let currentShot = null;

            lines.forEach(line => {
                const shotMatch = line.match(/é•œå¤´\s*(\d+)\s*([^\n]*)/i);
                
                if (shotMatch) {
                    if (currentShot) currentShots.push(currentShot);
                    
                    const shotNum = shotMatch[1];
                    const content = shotMatch[2].trim();
                    
                    // Detect shot size
                    const sizes = ['ç‰¹å†™', 'è¿‘æ™¯', 'ä¸­æ™¯', 'å…¨æ™¯', 'è¿œæ™¯'];
                    let size = 'ä¸­æ™¯';
                    sizes.forEach(s => {
                        if (content.includes(s)) size = s;
                    });

                    currentShot = {
                        number: shotNum,
                        size: size,
                        description: content.replace(new RegExp(size), '').trim(),
                        dialogues: [],
                        action: ''
                    };
                } else if (currentShot) {
                    // Check for dialogue (character: line)
                    const dialogueMatch = line.match(/^([^ï¼š:]+)[ï¼š:](.+)$/);
                    if (dialogueMatch) {
                        currentShot.dialogues.push({
                            character: dialogueMatch[1].trim(),
                            line: dialogueMatch[2].trim()
                        });
                    } else {
                        currentShot.action += (currentShot.action ? ' ' : '') + line.trim();
                    }
                }
            });

            if (currentShot) currentShots.push(currentShot);
            
            renderStoryboard(title, scene);
        }

        function renderStoryboard(title, scene) {
            const container = document.getElementById('storyboardContainer');
            
            if (currentShots.length === 0) {
                container.innerHTML = '<div class="text-center text-neutral-600">æœªèƒ½è§£æåˆ°é•œå¤´ä¿¡æ¯</div>';
                return;
            }

            const timestamp = new Date().toLocaleDateString('zh-CN');
            
            let html = `
                <div class="border-b-2 border-white pb-4 mb-8 flex justify-between items-end">
                    <div>
                        <h1 class="text-3xl font-black tracking-tight mb-1">${title}</h1>
                        <p class="text-neutral-500 text-sm mono">${scene}</p>
                    </div>
                    <div class="text-right text-xs text-neutral-600 mono">
                        <div>ç”Ÿæˆæ—¥æœŸ: ${timestamp}</div>
                        <div>æ€»é•œå¤´æ•°: ${currentShots.length}</div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            `;

            currentShots.forEach((shot, index) => {
                const sizeAbbr = {
                    'ç‰¹å†™': 'CU', 'è¿‘æ™¯': 'MCU', 'ä¸­æ™¯': 'MS', 
                    'å…¨æ™¯': 'FS', 'è¿œæ™¯': 'LS'
                }[shot.size] || 'MS';

                html += `
                    <div class="shot-card bg-neutral-900 p-6 comic-border relative overflow-hidden group">
                        <div class="absolute top-0 right-0 bg-white text-black text-xs font-bold px-3 py-1 mono">
                            #${String(shot.number).padStart(2, '0')}
                        </div>
                        
                        <div class="flex gap-4 mb-4">
                            <div class="w-16 h-16 border-2 border-white flex items-center justify-center font-black text-2xl mono bg-black">
                                ${sizeAbbr}
                            </div>
                            <div class="flex-1">
                                <div class="text-xs text-neutral-500 uppercase tracking-widest mb-1">æ™¯åˆ«</div>
                                <div class="text-lg font-bold">${shot.size}</div>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <div class="border-l-2 border-white pl-4">
                                <div class="text-xs text-neutral-500 uppercase tracking-widest mb-1">ç”»é¢å†…å®¹</div>
                                <p class="text-sm leading-relaxed text-neutral-300">${shot.description}</p>
                                ${shot.action ? `<p class="text-xs text-neutral-500 mt-2 italic">${shot.action}</p>` : ''}
                            </div>

                            ${shot.dialogues.length > 0 ? `
                                <div class="bg-black border border-neutral-800 p-4 mt-4">
                                    <div class="text-xs text-neutral-500 uppercase tracking-widest mb-2">å¯¹ç™½</div>
                                    ${shot.dialogues.map(d => `
                                        <div class="mb-2 last:mb-0">
                                            <span class="text-xs font-bold text-white uppercase">${d.character}</span>
                                            <p class="text-sm text-neutral-300 mt-1">${d.line}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>

                        <div class="mt-4 pt-4 border-t border-neutral-800 flex justify-between items-center text-xs text-neutral-600 mono">
                            <span>SHOT ${shot.number}</span>
                            <span class="group-hover:text-white transition-colors">[${index + 1}/${currentShots.length}]</span>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        function exportStoryboard() {
            if (currentShots.length === 0) {
                alert('è¯·å…ˆç”Ÿæˆåˆ†é•œç¨¿');
                return;
            }
            
            window.print();
        }

        // Auto-resize textarea
        const textarea = document.getElementById('scriptInput');
        textarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });
    </script>
</body>
</html>